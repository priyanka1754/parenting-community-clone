<div class="max-w-2xl mx-auto p-4">
  <ng-container *ngIf="event; else loadingOrError">
    <div class="flex flex-col md:flex-row gap-4">
      <img *ngIf="event.coverImageUrl" [src]="getFullMediaUrl(event.coverImageUrl)" alt="cover" class="w-full md:w-56 h-40 object-cover rounded" />
      <div class="flex-1">
        <h1 class="text-2xl font-bold mb-2">{{ event.title }}</h1>
        <div class="text-gray-600 mb-2">{{ event.description }}</div>
        <div class="mb-2 flex flex-wrap gap-2 text-sm">
          <span class="bg-gray-100 px-2 py-1 rounded">ðŸ“… {{ event.date | date:'mediumDate' }} {{ event.time }}</span>
          <span class="bg-gray-100 px-2 py-1 rounded">{{ event.category }}</span>
          <span class="bg-gray-100 px-2 py-1 rounded" *ngIf="event.eventType === 'Online'">Online</span>
          <span class="bg-gray-100 px-2 py-1 rounded" *ngIf="event.eventType === 'Offline'">{{ event.location }}</span>
          <span class="bg-gray-100 px-2 py-1 rounded" *ngIf="event.maxAttendees">Max: {{ event.maxAttendees }}</span>
          <span class="bg-gray-100 px-2 py-1 rounded" *ngIf="event.visibility !== 'Public'">{{ event.visibility }}</span>
          <span class="bg-red-100 text-red-600 px-2 py-1 rounded" *ngIf="event.isCancelled">Cancelled</span>
          <span class="bg-yellow-100 text-yellow-700 px-2 py-1 rounded" *ngIf="isEventFull(event)">Full</span>
        </div>
        <div class="flex items-center gap-2 mb-2">
          <img [src]="getHostAvatar()" class="w-7 h-7 rounded-full" />
          <span class="font-semibold">{{ event.host.name }}</span>
          <span class="text-xs text-gray-400 ml-2">Host</span>
        </div>
        <div class="flex items-center gap-4 mb-2">
          <span>RSVP: {{ getRSVPCount(event) }}</span>
          <span *ngIf="event.eventType === 'Online' && isLive(event)">
            <a [href]="event.meetingLink" target="_blank" class="btn btn-xs btn-success">Join Now</a>
          </span>
        </div>
        <div class="flex gap-2 mt-2">
          <button class="btn btn-primary btn-sm" [disabled]="rsvpLoading || event.isCancelled || isEventFull(event)" (click)="rsvp('Going')">
            {{ rsvpStatus === 'Going' ? 'You are Going' : 'RSVP: Going' }}
          </button>
          <button class="btn btn-outline btn-sm" [disabled]="rsvpLoading || event.isCancelled" (click)="rsvp('Interested')">
            {{ rsvpStatus === 'Interested' ? 'You are Interested' : 'Interested' }}
          </button>
          <button class="btn btn-outline btn-sm" [disabled]="rsvpLoading || event.isCancelled" (click)="rsvp('Not Going')">
            Not Going
          </button>
        </div>
        <div *ngIf="rsvpError" class="text-red-500 mt-2">{{ rsvpError }}</div>
        <div *ngIf="rsvpSuccess" class="text-green-600 mt-2">RSVP updated!</div>
      </div>
    </div>
    <hr class="my-6" />
    <div>
      <h3 class="font-semibold mb-2">Comments & Q&amp;A</h3>
      <form class="flex gap-2 mb-4" (ngSubmit)="addComment()">
        <input [(ngModel)]="newComment" name="comment" required maxlength="300" class="input input-bordered flex-1" placeholder="Ask a question or comment..." />
        <button class="btn btn-primary" type="submit" [disabled]="commentLoading">Post</button>
      </form>
      <div *ngIf="commentError" class="text-red-500 mb-2">{{ commentError }}</div>
      <div *ngIf="comments.length === 0" class="text-gray-400">No comments yet.</div>
      <div *ngFor="let c of comments" class="mb-3 p-2 bg-gray-50 rounded">
        <div class="flex items-center gap-2 mb-1">
          <img [src]="c.authorAvatar || '/assets/user-img.png'" class="w-5 h-5 rounded-full" />
          <span class="font-semibold text-sm">{{ c.authorName }}</span>
          <span class="text-xs text-gray-400 ml-2">{{ c.createdAt | date:'short' }}</span>
        </div>
        <div class="ml-7 text-sm">{{ c.comment }}</div>
      </div>
    </div>
    <hr class="my-6" />
    <!-- Feedback Section -->
    <div *ngIf="canGiveFeedback()" class="mb-8">
      <h3 class="font-semibold mb-2">Post-event Feedback</h3>
      <form class="flex flex-col gap-2 md:flex-row md:items-center" (ngSubmit)="submitFeedback()">
        <div class="flex gap-1 mb-2 md:mb-0">
          <button type="button" *ngFor="let emoji of feedbackEmojis" (click)="feedback.rating = emoji.value" [class.bg-blue-100]="feedback.rating === emoji.value" class="text-2xl rounded p-1">
            {{ emoji.icon }}
          </button>
        </div>
        <input [(ngModel)]="feedback.comment" name="feedbackComment" maxlength="200" class="input input-bordered flex-1" placeholder="Optional comment..." />
        <button class="btn btn-primary ml-2" type="submit" [disabled]="feedbackLoading">Submit</button>
      </form>
      <div *ngIf="feedbackError" class="text-red-500 mt-2">{{ feedbackError }}</div>
      <div *ngIf="feedbackSuccess" class="text-green-600 mt-2">Thank you for your feedback!</div>
    </div>
    <div *ngIf="feedbackList.length > 0" class="mb-8">
      <h3 class="font-semibold mb-2">Feedback from Attendees</h3>
      <div *ngFor="let fb of feedbackList" class="flex items-center gap-2 mb-2">
        <span class="text-xl">{{ getEmojiIcon(fb.rating) }}</span>
        <span class="text-gray-700">{{ fb.comment }}</span>
      </div>
    </div>
  </ng-container>
  <ng-template #loadingOrError>
    <div *ngIf="loading" class="text-center py-8">Loading event...</div>
    <div *ngIf="error" class="text-center text-red-500 py-8">{{ error }}</div>
  </ng-template>
</div>
